{% extends 'base_cms.html' %}
{% load static %}

{% block title %}About Us - ConstructPro{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/about-equalizer.css' %}">
<script>
    // Scroll-triggered animations for all sections
    document.addEventListener('DOMContentLoaded', function () {
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver(function (entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-in');
                }
            });
        }, observerOptions);

        // Observe Vision & Mission rows
        const vmRows = document.querySelectorAll('.vm-row');
        vmRows.forEach(el => {
            el.classList.add('scroll-animate');
            observer.observe(el);
        });

        // Observe all animated elements
        const animatedElements = document.querySelectorAll('.team-card, .testimonial-card, .project-card, .why-choose-card, .commitment-card, .process-card, .section-header, .about-image-wrapper, .about-text, .deck-stack, .deck-text');
        animatedElements.forEach(el => {
            el.classList.add('scroll-fade');
            observer.observe(el);
        });
    });
</script>
{% endblock %}

{% block content %}
<!-- About Section: Card Deck Stack with Rotating Images -->
<section class="about-deck-section">
    <div class="deck-container">
        <div class="deck-text">
            <h5>{{ about_page.deck_subtitle }}</h5>
            <h2>{{ about_page.deck_heading|safe|linebreaksbr }}</h2>
            <div class="deck-content">
                {{ about_page.deck_content_1|safe|linebreaks }}
                {{ about_page.deck_content_2|safe|linebreaks }}
            </div>
        </div>
        <div class="deck-stack">
            {% for img in deck_images %}
            <div class="deck-card" data-pos="{{ forloop.counter }}">
                {% if img.image %}
                <img src="{{ img.image.url }}" alt="{{ img.title }}">
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<script>
    // Card Deck Shuffle Animation
    document.addEventListener('DOMContentLoaded', function () {
        const cards = document.querySelectorAll('.deck-card');

        setInterval(() => {
            // 1. Find the card currently at the front (pos 5)
            const frontCard = document.querySelector('.deck-card[data-pos="5"]');
            if (!frontCard) return;

            // 2. Animate it moving out
            frontCard.classList.add('shuffling');

            // 3. Shift everyone else forward shortly after
            setTimeout(() => {
                cards.forEach(card => {
                    if (card === frontCard) return;
                    let currentPos = parseInt(card.getAttribute('data-pos'));
                    card.setAttribute('data-pos', currentPos + 1);
                });
            }, 200);

            // 4. After fly-out is mostly done, SNAP to back (no animation)
            setTimeout(() => {
                frontCard.classList.add('return'); // Disable transition
                frontCard.classList.remove('shuffling');
                frontCard.setAttribute('data-pos', '1'); // Move to back position physically

                // 5. Re-enable transition for next time (wait a tick)
                setTimeout(() => {
                    frontCard.classList.remove('return');
                }, 50);

            }, 600); // Wait for shuffle animation to complete

        }, 3500); // Shuffle every 3.5 seconds
    });
</script>

<!-- Vision & Mission - Variant 5: Asymmetric Professional -->
<section class="variant-5">
    <div class="vm-layout">
        <div class="vm-row">
            <div class="vm-main">
                <h3>Our Vision</h3>
                <h2>{{ about_page.vision_heading }}</h2>
                <div class="vm-desc">
                    {{ about_page.vision_content|safe|linebreaks }}
                </div>
            </div>
            <div class="vm-side">
                <div class="vm-stat">
                    <div class="vm-stat-number">{{ about_page.stat_1_value }}</div>
                    <div class="vm-stat-label">{{ about_page.stat_1_label }}</div>
                </div>
            </div>
        </div>

        <div class="vm-row">
            <div class="vm-main">
                <h3>Our Mission</h3>
                <h2>{{ about_page.mission_heading }}</h2>
                <div class="vm-desc">
                    {{ about_page.mission_content|safe|linebreaks }}
                </div>
            </div>
            <div class="vm-side">
                <div class="vm-stat">
                    <div class="vm-stat-number">{{ about_page.stat_2_value }}</div>
                    <div class="vm-stat-label">{{ about_page.stat_2_label }}</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Why Choose Our Outsourcing Services Section -->
<section class="why-choose-section">
    <div class="container">
        <div class="section-header">
            <div class="section-subtitle">WHY CHOOSE US</div>
            <h2 class="section-title">Why Choose Our <span class="text-gradient">Outsourcing Services?</span></h2>
        </div>

        <div class="why-choose-grid">
            {% for item in why_choose_us %}
            <div class="why-choose-card">
                <div class="why-choose-icon">
                    {{ item.icon_svg|safe }}
                </div>
                <h3>{{ item.title }}</h3>
                <p>{{ item.description }}</p>
            </div>
            {% endfor %}
        </div>

        <div class="service-tagline">
            <p>We act as your <strong>remote estimating team</strong>, ensuring precision and reliability on every
                project</p>
        </div>
    </div>
</section>

<!-- Our Commitment Section -->
<section class="commitment-section">
    <div class="container">
        <div class="section-header">
            <div class="section-subtitle">OUR PROMISE</div>
            <h2 class="section-title">Our <span class="text-gradient">Commitment</span></h2>
        </div>

        <div class="commitment-grid">
            {% for item in commitments %}
            <div class="commitment-card">
                <div class="commitment-number">{{ item.number }}</div>
                <h3>{{ item.title }}</h3>
                <p>{{ item.description }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- How It Works Section -->
<!-- <section class="process-section">
    <div class="container">
        <div class="section-header">
            <div class="section-subtitle">HOW IT WORKS</div>
            <h2 class="section-title">Our Working <span class="text-gradient">Process</span></h2>
        </div>

        <div class="process-grid">
            {% for step in process_steps %}
            <div class="process-card">
                <div class="process-number">{{ step.number }}</div>
                <div class="process-icon">
                    {{ step.icon_svg|safe }}
                </div>
                <h3>{{ step.title }}</h3>
                <p>{{ step.description }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section> -->







<script>
    document.addEventListener('DOMContentLoaded', function () {
        const testimonialGrid = document.querySelector('.testimonials-grid');
        if (!testimonialGrid) return;

        // Clone items to ensure loop
        const originalCards = Array.from(testimonialGrid.children);
        // Duplicate the set to allow for loop
        originalCards.forEach(card => {
            const clone = card.cloneNode(true);
            testimonialGrid.appendChild(clone);
        });

        let autoScrollInterval;
        const scrollDelay = 3000;
        let currentIndex = 0;
        const totalOriginal = originalCards.length;

        function startAutoScroll() {
            stopAutoScroll(); // Clear any existing
            autoScrollInterval = setInterval(() => {
                const card = testimonialGrid.firstElementChild;
                if (!card) return;

                const cardWidth = card.offsetWidth;
                const gap = 20;
                const itemWidth = cardWidth + gap;

                currentIndex++;

                // If we reach the start of the cloned set (index == totalOriginal)
                // We let it animate to this position (viewing the first clone)
                // Then AFTER animation, we quickly swap back to index 0 (real first item)
                // However, waiting for animation is tricky with set interval.
                // Alternative: 
                // If we are currently AT the last original item, we scroll to the first clone.
                // Then immediately reset to the first original item? No, that would flicker.
                // WE WANT: 0 -> 1 -> 2 ... -> last -> clone0 -> (instantly reset to 0) -> 1

                // If we just moved to the first clone (index == totalOriginal)
                // We perform the scroll to that clone.
                // Then we set a timeout matching smooth scroll duration to reset scrollLeft to 0 and index to 0.

                if (currentIndex > totalOriginal) {
                    // Safety reset if somehow went way past
                    currentIndex = 0;
                    testimonialGrid.scrollTo({ left: 0, behavior: 'auto' });
                    return;
                }

                const targetScroll = currentIndex * itemWidth;
                testimonialGrid.scrollTo({
                    left: targetScroll,
                    behavior: 'smooth'
                });

                // Check loop condition
                if (currentIndex === totalOriginal) {
                    // We just scrolled to the first clone. It looks identical to index 0.
                    // Wait for digest/scroll (approx 500ms for smooth scroll) then reset.
                    setTimeout(() => {
                        currentIndex = 0;
                        testimonialGrid.scrollTo({
                            left: 0,
                            behavior: 'auto'
                        });
                    }, 600); // 600ms buffer roughly covers css smooth scroll
                }

            }, scrollDelay);
        }

        function stopAutoScroll() {
            if (autoScrollInterval) {
                clearInterval(autoScrollInterval);
            }
        }

        // Initialize
        startAutoScroll();

        // Pause on interaction
        testimonialGrid.addEventListener('mouseenter', stopAutoScroll);
        testimonialGrid.addEventListener('mouseleave', startAutoScroll);
        testimonialGrid.addEventListener('touchstart', stopAutoScroll);
        testimonialGrid.addEventListener('touchend', startAutoScroll);

        // Handle resize
        window.addEventListener('resize', () => {
            stopAutoScroll();
            currentIndex = 0; // Reset to start on resize to avoid misalignment
            testimonialGrid.scrollTo({ left: 0, behavior: 'auto' });
            startAutoScroll();
        });
    });
</script>
{% endblock %}